<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JavaScript Analyzer - PayloadLab</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
 <style>
  @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');

  body {
    background-color: #000000;
    color: #c9d1d9;
    font-family: 'Fira Code', monospace;
    margin: 0;
    padding: 0;
  }

  header {
    background-color: #0d0d0d;
    padding: 30px;
    text-align: center;
    border-bottom: 1px solid #222;
  }

  h1 {
    margin: 0;
    color: #00ff99;
    font-size: 28px;
    text-shadow: 0 0 5px #00ff99;
  }

  .container {
    padding: 20px;
    max-width: 1000px;
    margin: auto;
  }

  /* Neon-style custom file input */
  .custom-file-input {
    position: relative;
    overflow: hidden;
    display: inline-block;
    background-color: #00ff99;
    color: #000;
    font-weight: bold;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
    margin-bottom: 10px;
    box-shadow: 0 0 10px #00ff99;
  }

  .custom-file-input:hover {
    background-color: #00cc7a;
  }

  .custom-file-input input[type="file"] {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    cursor: pointer;
    height: 100%;
    width: 100%;
  }

  button {
    background-color: #00ff99;
    color: #000;
    border: none;
    padding: 10px 15px;
    margin: 10px 5px 0 0;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s ease;
    box-shadow: 0 0 10px #00ff99;
  }

  button:hover {
    background-color: #00cc7a;
  }

  #drop-zone {
    border: 2px dashed #00ff99;
    padding: 30px;
    text-align: center;
    margin-top: 20px;
    color: #00ff99;
    transition: 0.3s;
    border-radius: 10px;
  }

  #drop-zone:hover {
    background-color: #111;
  }

  #result {
    background-color: #0d0d0d;
    border-left: 4px solid #00ff99;
    margin-top: 20px;
    padding: 15px;
    white-space: pre-wrap;
    overflow-x: auto;
    border-radius: 6px;
  }

  .highlight {
    background-color: #ff0044;
    color: white;
    font-weight: bold;
    padding: 2px 4px;
    border-radius: 4px;
  }

  .tooltip {
    position: relative;
    display: inline-block;
    border-bottom: 1px dotted #ff0044;
  }

  .tooltip .tooltiptext {
    visibility: hidden;
    width: 220px;
    background-color: #111;
    color: #fff;
    text-align: left;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -110px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
  }

  .stats {
    margin-top: 10px;
    font-size: 14px;
    color: #888;
  }

  .warning {
    background-color: #ff004430;
    color: #ff4d4d;
    padding: 10px;
    margin-top: 10px;
    border: 1px solid #ff4d4d;
    border-radius: 5px;
  }
</style>
</head>
<body>
  <header>
    <h1> JavaScript Code Analyzer  PayloadLab</h1>
  </header>
  <div class="container">
    <label class="custom-file-input">
      Upload JS File
      <input type="file" id="fileInput" accept=".js">
    </label>

    <button id="downloadBtn" class="btn-download" style="display:none;">Download Beautified Code</button>
    <button id="exportHtmlBtn" class="btn-download" style="display:none;">Export as HTML</button>
    <div id="drop-zone">Or drag and drop a JavaScript file here</div>
    <div class="stats" id="stats"></div>
    <div id="result"></div>
    <div id="warning"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>
  <script>
    const keywords = [
      'apikey', 'token', 'secret', 'password', 'eval', 'innerHTML', 'document.cookie', 
      'localStorage', 'sessionStorage', 'fetch', 'XMLHttpRequest', 'WebSocket', 
      'Function("', 'atob', 'btoa', 'setTimeout(', 'new Function', 'return this'
    ];

    const descriptions = {
      'eval': 'Executes dynamic code - high risk.',
      'innerHTML': 'Manipulates HTML content - potential XSS risk.',
      'document.cookie': 'Accessing cookies.',
      'localStorage': 'Accessing local storage.',
      'sessionStorage': 'Accessing session storage.',
      'fetch': 'Fetching data from external sources.',
      'XMLHttpRequest': 'Manual HTTP requests - can be malicious.',
      'WebSocket': 'Direct connection - may be used for stealth.',
      'Function("': 'Dynamic code execution inside Function - suspicious.',
      'new Function': 'Creates executable code - dangerous.',
      'return this': 'Old method to access the global object.',
      'atob': 'Decodes base64 to string.',
      'btoa': 'Encodes string to base64.',
      'setTimeout(': 'Can delay malicious actions.',
      'apikey': 'Sensitive API key.',
      'token': 'Authentication token.',
      'secret': 'Secret or password.',
      'password': 'Password.'
    };

    const fileInput = document.getElementById('fileInput');
    const resultDiv = document.getElementById('result');
    const statsDiv = document.getElementById('stats');
    const downloadBtn = document.getElementById('downloadBtn');
    const exportHtmlBtn = document.getElementById('exportHtmlBtn');
    const warningDiv = document.getElementById('warning');

    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
    document.getElementById('drop-zone').addEventListener('dragover', e => e.preventDefault());
    document.getElementById('drop-zone').addEventListener('drop', e => {
      e.preventDefault();
      if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
    });

    function handleFile(file) {
      if (!file || !file.name.endsWith('.js')) return alert("Please upload a .js file");
      const reader = new FileReader();
      reader.onload = (e) => {
        const rawCode = e.target.result;
        const beautified = beautifyCode(rawCode);
        const highlighted = highlightSensitive(beautified);
        const stats = analyzeStats(beautified);

        resultDiv.innerHTML = highlighted;
        statsDiv.innerHTML = ` Lines: ${stats.total} |  Sensitive: ${stats.sensitive} |  Words: ${stats.words} |  Variables: ${stats.variables}`;
        warningDiv.innerHTML = stats.sensitive >= 5 ? `<div class="warning"> High number of sensitive lines detected, review the code carefully!</div>` : '';

        prepareDownload(beautified);
        prepareHTMLDownload(highlighted);
      };
      reader.readAsText(file);
    }

    function beautifyCode(code) {
      return js_beautify(code, { indent_size: 2 });
    }

    function highlightSensitive(code) {
      return code.split('\n').map(line => {
        for (let k of keywords) {
          if (line.toLowerCase().includes(k.toLowerCase())) {
            const desc = descriptions[k] || "Sensitive code";
            return `<span class="tooltip highlight">${escapeHtml(line)}<span class="tooltiptext">${desc}</span></span>`;
          }
        }
        return escapeHtml(line);
      }).join('\n');
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
      }[m]));
    }

    function analyzeStats(code) {
      const lines = code.split('\n');
      const sensitiveLines = lines.filter(line => keywords.some(k => line.toLowerCase().includes(k.toLowerCase())));
      const words = code.match(/\b\w+\b/g)?.length || 0;
      const variables = (code.match(/(var|let|const)\s+\w+/g) || []).length;
      return { total: lines.length, sensitive: sensitiveLines.length, words, variables };
    }

    function prepareDownload(code) {
      const blob = new Blob([code], { type: 'text/javascript' });
      const url = URL.createObjectURL(blob);
      downloadBtn.href = url;
      downloadBtn.download = "beautified-code.js";
      downloadBtn.style.display = 'inline-block';
    }

    function prepareHTMLDownload(htmlContent) {
      const blob = new Blob(["<pre>" + htmlContent + "</pre>"], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      exportHtmlBtn.href = url;
      exportHtmlBtn.download = "analyzed-code.html";
      exportHtmlBtn.style.display = 'inline-block';
    }
  </script>
</body>
</html>

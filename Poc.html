<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebSocket CORS PoC</title>
</head>
<body>
  <h2>WebSocket CORS PoC</h2>

  <button id="openWs">Open WS</button>
  <button id="sendPing" disabled>Send Ping</button>
  <button id="sendBlock" disabled>Send getBlockByHeight</button>

  <pre id="log"></pre>

  <script>
    let ws;

    function log(msg) {
      document.getElementById("log").textContent += msg + "\n";
    }

    document.getElementById("openWs").onclick = function() {
      // Endpoint الحقيقي
      ws = new WebSocket("wss://access.mainnet.nodes.onflow.org/ws");  

      ws.onopen = function() {
        log("OPEN: connection established");
        document.getElementById("sendPing").disabled = false;
        document.getElementById("sendBlock").disabled = false;
      };

      ws.onmessage = function(evt) {
        log("RECEIVED: " + evt.data);
      };

      ws.onerror = function(err) {
        log("ERROR: " + err);
      };

      ws.onclose = function() {
        log("CLOSED: connection closed");
      };
    };

    document.getElementById("sendPing").onclick = function() {
      const msg = {
        jsonrpc: "2.0",
        id: 2,
        method: "ping",
        params: []
      };
      ws.send(JSON.stringify(msg));
      log("SENT: " + JSON.stringify(msg));
    };

    document.getElementById("sendBlock").onclick = function() {
      const msg = {
        jsonrpc: "2.0",
        id: 3,
        method: "getBlockByHeight",
        params: [{ height: 1 }]
      };
      ws.send(JSON.stringify(msg));
      log("SENT: " + JSON.stringify(msg));
    };
  </script>
</body>
</html>

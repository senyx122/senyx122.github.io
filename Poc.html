<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>Flow WS CORS PoC</title>
</head>
<body>
  <h3>WebSocket CORS PoC</h3>
  <button id="run">Open WS</button>
  <pre id="out"></pre>

  <script>
    const out = document.getElementById('out');
    function log(...t){ out.textContent += t.join(' ') + '\n'; console.log(...t); }

    document.getElementById('run').addEventListener('click', () => {
      try {
        // افتح اتصال WebSocket من نفس origin (ستُرسل قيمة Origin تلقائياً)
        const ws = new WebSocket('wss://access.mainnet.nodes.flow.com/v1/ws');

        ws.onopen = () => {
          log('OPEN: connection established');
          // لو الخادم يرسل رسائل تلقائياً ستظهر هنا
        };

        ws.onmessage = (m) => {
          log('MSG:', m.data);
        };

        ws.onerror = (e) => {
          log('ERROR:', e && e.message ? e.message : e);
        };

        ws.onclose = (c) => {
          log('CLOSED: code=' + c.code + ' reason=' + c.reason);
        };
      } catch (err) {
        log('Exception: ' + err);
      }
    });
  </script>
</body>
</html>
